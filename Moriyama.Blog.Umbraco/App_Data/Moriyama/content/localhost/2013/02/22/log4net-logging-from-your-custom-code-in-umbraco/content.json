{
  "Name": "Log4net logging from your custom code in Umbraco",
  "Type": "BlogPost",
  "CreateDate": "2013-02-22T09:27:41",
  "UpdateDate": "2015-01-19T18:44:03",
  "CreatorName": "Darren Ferguson",
  "WriterName": "Darren Ferguson",
  "Url": "http://localhost/2013/02/22/log4net-logging-from-your-custom-code-in-umbraco/",
  "RelativeUrl": "/2013/02/22/log4net-logging-from-your-custom-code-in-umbraco/",
  "Content": {
    "umbracoUrlAlias": "",
    "HideInNavigation": false,
    "umbracoInternalRedirectId": "",
    "redirect": "",
    "displayDate": "2013-02-22T09:00:00Z",
    "title": "Log4net logging from your custom code in Umbraco",
    "shortUrl": "",
    "summary": "'Log4net logging from your custom code in Umbraco' - a blog post by Darren Ferguson about Log4net, Umbraco written on 22 February 2013",
    "tags": "Log4net, Umbraco, Logging, Logger",
    "bodyText": "\r\n<p><strong><em>Disclaimer: this isn't an introduction to log4net.\r\nPlease Google for a more generic introduction.</em></strong></p>\r\n\r\n<p>Recent versions of Umbraco ship with <strong><em><a\r\nhref=\"http://logging.apache.org/log4net/\">Log4Net</a></em></strong>\r\n- previously it was reasonably straightforward to add it to your\r\ncustomisations but now it is really simple to <em>do</em> logging\r\nin your custom code. It is also arguably essential as there isn't a\r\ncurrent method for receiving the Umbraco page assembly trace in the\r\nnew MVC \"rendering mode\".</p>\r\n\r\n<p>This blog post will explain how to get a reference to a\r\n<strong><em><a\r\nhref=\"http://logging.apache.org/log4net/\">log4net</a></em></strong>\r\nlogger in your custom code and then how to control the Level of\r\nyour logging and filter messages from your code to their own log\r\nfile.</p>\r\n\r\n<p>First up you'll need a reference to log4net in your project. I\r\nrecommend referencing the version of log4net that ships with\r\nUmbraco directly in the <strong><em>/bin</em></strong> folder of\r\nthe distribution. Umbraco ships with a patched version of log4net -\r\nbut the assembly version matches an official version which has got\r\nme into a few challenges when referencing via nuget.</p>\r\n\r\n<p>Once I have the reference I can add the following to each class\r\nthat I want to log from:</p>\r\n\r\n<pre class=\"brush: csharp;\">\r\npublic class Class1\r\n{\r\n    private static readonly ILog Log =\r\n        LogManager.GetLogger(\r\n            MethodBase.GetCurrentMethod().DeclaringType\r\n        );\r\n</pre>\r\n\r\n<p>You normally put this just inside the class declaration as\r\nabove. The argument to GetLogger just resolves to the current type\r\nand is a convenience so you can paste the same snippet into any\r\nclass without having to make modifications.</p>\r\n\r\n<p>You can now use your Logger anywhere in your code:</p>\r\n\r\n<pre class=\"brush: csharp;\">\r\nLog.Debug(\"Umbraco is starting\");\r\nLog.Info(string.Format(\"Umbraco is running on {0}\", Environment.MachineName));\r\n</pre>\r\n\r\n<p>And you are done - kind of. If you take a look in\r\n<strong><em>~/App_Data/Logs/UmbracoTraceLog.txt</em></strong> then\r\nyou should find your log messages. The problem is they are\r\ninterspersed with lots of other messages that Umbraco logs itself\r\nmaking them rather hard to find.</p>\r\n\r\n<p>With a little configuration you can write your messages to their\r\nown log file. Start by opening up\r\n<em><strong>~/config/log4net.config</strong></em></p>\r\n\r\n<p>Take a copy of the Xml node that begins:</p>\r\n\r\n<pre class=\"brush: xml;\">\r\n&lt;appender name=\"AsynchronousLog4NetAppender\"\r\n</pre>\r\n\r\n<p>And give it a different and unique name attribute. Also, specify\r\na path to your custom log file in the file child node. My modified\r\nexample looks like this:</p>\r\n\r\n<pre class=\"brush: xml;\">\r\n&lt;appender name=\"CustomAppender\" type=\"Umbraco.Core.Logging.AsynchronousRollingFileAppender, Umbraco.Core\"&gt;\r\n    &lt;file value=\"App_Data\\Logs\\Moriyama.log.txt\" /&gt;\r\n    &lt;lockingModel type=\"log4net.Appender.FileAppender+MinimalLock\" /&gt;\r\n    &lt;appendToFile value=\"true\" /&gt;\r\n    &lt;rollingStyle value=\"Date\" /&gt;\r\n    &lt;maximumFileSize value=\"5MB\" /&gt;\r\n    &lt;layout type=\"log4net.Layout.PatternLayout\"&gt;\r\n        &lt;conversionPattern value=\"%date [%thread] %-5level %logger - %message%newline\" /&gt;\r\n    &lt;/layout&gt;\r\n&lt;/appender&gt;\r\n</pre>\r\n\r\n<p>The snippet above is just a definition for your custom log file.\r\nYou can read lots more about configuring appenders in the log4net\r\ndocumentation.</p>\r\n\r\n<p>Finally you need to declare a logger for your namespace, add the\r\nfollowing logger declaration to log4net.config</p>\r\n\r\n<pre class=\"brush: xml;\">\r\n&lt;logger name=\"Moriyama.UmbracoCustom\"&gt;\r\n    &lt;level value=\"DEBUG\" /&gt;\r\n    &lt;appender-ref ref=\"CustomAppender\" /&gt;\r\n&lt;/logger&gt;\r\n</pre>\r\n\r\n<p>The <em>name attribute</em> of the logger is a namespace or\r\nclass name that the logger applies to - change this to the root\r\nnamespace of your Umbraco customisation project. The <em>ref</em>\r\nattribute of the <em>appender-ref</em> node should match the\r\nappender name that you create in the previous step.</p>\r\n\r\n<p>You logging code should now log into your custom log file.\r\n<em>Be aware that you should probably raise the level of your\r\nloggers to at least <strong>ERROR</strong> when going into\r\nproduction.</em></p>\r\n\r\n<p>Here is a complete class example that writes some messages to a\r\nlog file when Umbraco starts:</p>\r\n\r\n<pre class=\"brush: csharp;\">\r\nusing System;\r\nusing System.Reflection;\r\nusing log4net;\r\nusing umbraco.interfaces;\r\n\r\nnamespace Moriyama.UmbracoCustom\r\n{\r\n    public class Class1 : IApplicationStartupHandler\r\n    {\r\n        private static readonly ILog Log = \r\n            LogManager.GetLogger(\r\n                MethodBase.GetCurrentMethod().DeclaringType\r\n            );\r\n\r\n        public Class1()\r\n        {\r\n            Log.Debug(\"Umbraco is starting\");\r\n            Log.Info(string.Format(\"Umbraco is running on {0}\", Environment.MachineName));\r\n        }\r\n    }\r\n}\r\n</pre>\r\n\r\n<p>The resulting output in my custom log file is as follows:</p>\r\n\r\n<pre>\r\n2013-02-22 09:21:17,154 [34] DEBUG Moriyama.UmbracoCustom.Class1 - Umbraco is starting\r\n2013-02-22 09:21:17,154 [34] INFO&nbsp; Moriyama.UmbracoCustom.Class1 - Umbraco is running on DARREN-VAIO\r\n</pre>\r\n\r\n<p>With log4net you can change the format of your log entries and\r\nalso log to a database, XML file or even email.</p>\r\n\r\n<p>That is all for now - happy logging.</p>\r\n\r\n<p><em>Sorry I haven't blogged much this year - I will try to do\r\nbetter in 2013.</em></p>\r\n",
    "commentsDisabled": 0
  },
  "Template": "Post",
  "CacheTime": null,
  "SortOrder": 1,
  "Level": 5
}